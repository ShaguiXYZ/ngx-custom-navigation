<article class="component-container">
  <quote-header-title>
    <span nxQuoteLiteral="header"></span>
    <p nxCopytext="normal" nxQuoteLiteral="subheader"></p>
  </quote-header-title>
  <section class="form-container">
    <nx-accordion variant="light" [multi]="true">
      <nx-expansion-panel [expanded]="true">
        <nx-expansion-panel-header>
          <nx-expansion-panel-title nxHeadline="subsection-xsmall">
            <span nxQuoteLiteral="fuel"></span>
          </nx-expansion-panel-title>
        </nx-expansion-panel-header>
        @if(formValidations.fuel) {
        <nx-error appearance="text" nxFormfieldError><span nxQuoteLiteral="error-required"></span> </nx-error>
        }
        <div class="vehicle__selections">
          @for(fuel of fuels; track $index) { @let _selectedFuel = fuel.index === selectedFuel?.index;
          <div class="vehicle__selection nx-margin-2xs">
            @defer(on viewport) {
            <quote-selectable-option
              [selected]="_selectedFuel"
              [nxTrack]="{
                displayment: selectedCubicCapacity?.index,
                fuel: fuel.index,
                power: selectedPower?.index
              }"
              [nxTrackEvents]="['click']"
              (uiSelect)="selectFuel(fuel)"
            >
              <div class="card-container">
                <span nxCopytext="medium" class="nx-margin-s" [ngClass]="{ 'nx-font-weight-bold': _selectedFuel }"> {{ fuel.data }}</span>
              </div>
            </quote-selectable-option>
            } @placeholder {
            <div class="card-placeholder"></div>
            }
          </div>
          }
        </div>
      </nx-expansion-panel>

      <nx-expansion-panel #cubicCapacityPanel [expanded]="selectedFuel">
        <nx-expansion-panel-header>
          <nx-expansion-panel-title nxHeadline="subsection-xsmall">
            <span nxQuoteLiteral="cubic-capacity"></span>
          </nx-expansion-panel-title>
        </nx-expansion-panel-header>
        @if(formValidations.cubicCapacity) {
        <nx-error appearance="text" nxFormfieldError><span nxQuoteLiteral="error-required"></span> </nx-error>
        }
        <div class="vehicle__selections">
          @for(cubicCapacity of cubicCapacities; track $index) { @let _selectedCubicCapacityselected = cubicCapacity.index ===
          selectedCubicCapacity?.index;
          <div class="vehicle__selection nx-margin-2xs">
            @defer(on viewport) {
            <quote-selectable-option
              [selected]="_selectedCubicCapacityselected"
              [nxTrack]="{
                displayment: cubicCapacity.index,
                fuel: selectedFuel?.index,
                power: selectedPower?.index
              }"
              [nxTrackEvents]="['click']"
              (uiSelect)="selectCubicCapacity(cubicCapacity)"
            >
              <div class="card-container">
                <span nxCopytext="medium" class="nx-margin-s" [ngClass]="{ 'nx-font-weight-bold': _selectedCubicCapacityselected }">
                  {{ cubicCapacity.data }}</span
                >
              </div>
            </quote-selectable-option>
            } @placeholder {
            <div class="card-placeholder"></div>
            }
          </div>
          }
          <div class="vehicle__not_known nx-margin-2xs">
            @let _cubicCapacityNotKnown = selectedCubicCapacity?.index === cubicCapacityNotKnown.index;
            <quote-selectable-option
              [selected]="_cubicCapacityNotKnown"
              [nxTrack]="{
                displayment: cubicCapacityNotKnown.index,
                fuel: cubicCapacityNotKnown.index,
                power: selectedPower?.index
              }"
              [nxTrackEvents]="['click']"
              (uiSelect)="selectCubicCapacity(cubicCapacityNotKnown)"
            >
              <div class="card-container">
                <span
                  nxCopytext="medium"
                  class="nx-margin-s"
                  [ngClass]="{ 'nx-font-weight-bold': _cubicCapacityNotKnown }"
                  nxQuoteLiteral="cubic-capacity-not-known"
                ></span>
              </div>
            </quote-selectable-option>
          </div>
        </div>
      </nx-expansion-panel>

      <nx-expansion-panel #powerPanel [expanded]="selectedCubicCapacity">
        <nx-expansion-panel-header>
          <nx-expansion-panel-title nxHeadline="subsection-xsmall">
            <span nxQuoteLiteral="power"></span>
          </nx-expansion-panel-title>
        </nx-expansion-panel-header>
        @if(formValidations.power) {
        <nx-error appearance="text" nxFormfieldError><span nxQuoteLiteral="error-required"></span> </nx-error>
        }
        <div class="vehicle__selections">
          @for(power of powers; track power.index) { @let _selectedPower = power.index === selectedPower?.index;
          <div class="vehicle__selection nx-margin-2xs">
            @defer(on viewport) {
            <quote-selectable-option
              [selected]="_selectedPower"
              [nxTrack]="{
                displayment: selectedCubicCapacity?.index,
                fuel: selectedFuel?.index,
                power: power.index
              }"
              [nxTrackEvents]="['click']"
              (uiSelect)="selectPower(power)"
            >
              <div class="card-container">
                <span nxCopytext="medium" class="nx-margin-s" [ngClass]="{ 'nx-font-weight-bold': _selectedPower }"> {{ power.data }}</span>
              </div>
            </quote-selectable-option>
            } @placeholder {
            <div class="card-placeholder"></div>
            }
          </div>
          }
          <div class="vehicle__not_known nx-margin-2xs">
            @let _powerNotKnown = selectedPower?.index === powerNotKnown.index;
            <quote-selectable-option
              [selected]="_powerNotKnown"
              [nxTrack]="{
                displayment: selectedCubicCapacity?.index,
                fuel: selectedFuel?.index,
                power: powerNotKnown.index
              }"
              [nxTrackEvents]="['click']"
              (uiSelect)="selectPower(powerNotKnown)"
            >
              <div class="card-container">
                <span
                  nxCopytext="medium"
                  class="nx-margin-s"
                  [ngClass]="{ 'nx-font-weight-bold': _powerNotKnown }"
                  nxQuoteLiteral="power-not-known"
                ></span>
              </div>
            </quote-selectable-option>
          </div>
        </div>
      </nx-expansion-panel>
    </nx-accordion>
  </section>
  <quote-footer
    [trackInfo]="{
      displayment: selectedCubicCapacity?.index,
      fuel: selectedFuel?.index,
      power: powerNotKnown.index
    }"
    (uiOnNext)="populateData()"
  />
</article>
